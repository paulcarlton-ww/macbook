        - apiVersion: templates.weave.works/v1alpha1
          kind: GitOpsSet
          metadata:
            labels:
              app.kubernetes.io/name: gitopsset
              app.kubernetes.io/instance: gitopsset-sample
              app.kubernetes.io/part-of: gitopssets-controller
              app.kubernetes.io/managed-by: kustomize
              app.kubernetes.io/created-by: gitopssets-controller
            name: vpcs
          spec:
            generators:
              - gitRepository:
                  repositoryRef: flux-system
                  files:
                    - path: beta/beta-test1.yaml
            templates:
              - repeat: "{ .vpcs }"
                content:
                - kind: Kustomization
                  apiVersion: kustomize.toolkit.fluxcd.io/v1beta2
                  metadata:
                    name: "{{ .vpc_name }}-deploy"
                    namespace: flux-system
                  spec:
                    interval: 10m0s
                    sourceRef:
                      kind: GitRepository
                      name: flux-system
                    path: ./infra/vpc-deploy
                    prune: true
                    wait: true
                    timeout: 5m
                    validation: client
                    postBuild:
                      substitute:
                        awsRegion: '{{ .aws_region }}'
                        vpcName: '{{ .repeat.vpc_name }}'
                        publicSubnetCount: '{{ .repeat.publicsubnets }}'
                        privateSubnetCount: '{{ .repeat.privatesubnets }}'
                        vpcCIDR: '{{ .repeat.cidr }}'